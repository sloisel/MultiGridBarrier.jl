using MultiGridBarrier
using Test
using LinearAlgebra

Base.show(x, ::MIME{Symbol("text/html")}, ::String) = nothing

@testset "MultiGridBarrier.jl" begin
    z = reshape(Float64[-1,-1,-1,1,0,0,2,2],(:,2))
    @test norm(fem1d_solve(L=1,p=1.0)-z)<1e-6
    z = reshape([2.0,1.0,2.0,1.0,2.0,1.0,0.9629629615502254,2.0,1.0,2.0,1.0,2.0,1.0,0.9629629615502254,2.8284271303696036,0.0,2.0,0.0,2.0,0.0,0.0,2.0,0.0,2.8284271303696036,0.0,2.0,0.0,0.0],(:,2))
    @test norm(fem2d_solve(L=1,p=1.0)-z)<1e-6
    z = reshape([-1.0,-0.9937184291481691,-1.0606601198186663,-0.28661158923558694,1.0,5.3340857286533046e-8,6.270131188059596e-8,1.0297480733710706e-7,2.999999898325467,5.999999681130596],(:,2))
    @test norm(spectral1d_solve(n=5,p=1.0)-z)<1e-6
    z = reshape([2.0,1.5,1.0,1.5,2.0,1.5,1.3293564567737008,1.000000018263945,1.3293564567737008,1.5,1.0,1.000000018263945,0.9999999999999992,1.000000018263945,1.0,1.5,1.3293564567737008,1.000000018263945,1.3293564567737006,1.5,2.0,1.5,1.0,1.5,2.0,2.8284271380814046,1.4605935026827006,1.6292452074881896e-7,1.460593502682701,2.8284271380814046,1.4605935026827004,0.9999999768073243,5.33408572865331e-8,0.9999999768073249,1.4605935026827008,1.6292452092368193e-7,5.33408572865331e-8,5.3340857286533106e-8,5.33408572865331e-8,1.6292452052399464e-7,1.4605935026827006,0.9999999768073246,5.334085728653312e-8,0.9999999768073247,1.460593502682701,2.8284271380814046,1.4605935026827008,1.6292452069885802e-7,1.4605935026827015,2.8284271380814046],(:,2))
    @test norm(spectral2d_solve(n=5,p=1.0)-z)<1e-6
    z = [-1.0 0.0 0.0; 0.0 0.0 0.0; 0.0 0.0 0.0; 1.0 0.0 0.0;;; -1.0 1.0000000112468264 0.7500000142459804; -0.24999999700084627 0.06250000974724965 0.7500000142459804; -0.24999999700084627 0.06250000974724965 1.2500000082476728; 1.0 1.0000000112468264 1.2500000082476728;;; -1.0 1.00000002 0.5000000363324867; -0.4999999836675137 0.2500000036675139 0.5000000363324867; -0.4999999836675137 0.2500000036675139 1.5000000036675138; 1.0 1.00000002 1.5000000036675138]
    @test norm(parabolic_solve(method=FEM1D,L=1,h=0.5,p=1.0)-z)<1e-6
    @test (MultiGridBarrier.amg_precompile(); true)
    @test (MultiGridBarrier.parabolic_precompile(); true)
end
